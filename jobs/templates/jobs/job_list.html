{% extends "base.html" %}
{% block title %}Jobs{% endblock %}

{% block content %}

<h2 class="mb-4">Job Listings</h2>

<!-- SEARCH -->
<form method="get" class="mb-4">
  <div class="row g-2 align-items-end">
    <div class="col-md-5">
      <label class="form-label small">Keyword</label>
      <input type="text" name="q"
             value="{{ query }}"
             class="form-control"
             placeholder="Search job title or skills">
    </div>

    <div class="col-md-4">
      <label class="form-label small">Location</label>
      <input type="text" name="location"
             value="{{ location }}"
             class="form-control"
             placeholder="Location">
    </div>

    <div class="col-md-3">
      <button class="btn btn-primary w-100">
        Search Jobs
      </button>
    </div>
  </div>
</form>

<!-- JOB CARDS -->
<div class="row g-4">

{% for job in jobs %}
  
<div class="col-md-6 col-lg-4">

  <div class="card shadow-sm border-0 h-100 job-card position-relative"
       data-skill="{{ job.title|lower }} {{ job.description|lower }}"
       data-location="{{ job.location|lower }}">

    <!-- Clickable Overlay -->
    <a href="{% url 'jobs:job_detail' job.id %}"
       class="stretched-link"></a>

    <div class="card-body d-flex flex-column">

      <h5 class="card-title">
        {{ job.title }}
      </h5>

      <p class="text-muted small mb-2">
        {{ job.company }} â€¢ {{ job.location }}
      </p>

      <p class="card-text text-muted">
        {{ job.description|truncatewords:22 }}
      </p>

      <div class="mt-auto position-relative" style="z-index: 2;">

        {% if user.is_authenticated %}

          {% if job.id in applied_jobs %}
            <span class="badge bg-success">Applied</span>

          {% else %}

            {% if job.id in saved_jobs %}
              <button class="btn btn-sm btn-success mb-2" disabled>
                âœ… Saved
              </button>
            {% else %}
              <a href="{% url 'jobs:save_job' job.id %}"
                 class="btn btn-sm btn-outline-success mb-2">
                ðŸ’¾ Save Job
              </a>
            {% endif %}

            {% if completion == 100 %}
              <a href="{% url 'jobs:apply' job.id %}"
                 class="btn btn-primary btn-sm w-100">
                Apply Now
              </a>
            {% else %}
              <a href="{% url 'profiles:setup' %}"
                 class="btn btn-warning btn-sm w-100">
                Complete Profile to Apply
              </a>
            {% endif %}

          {% endif %}

        {% else %}
          <a href="{% url 'login' %}"
             class="btn btn-outline-secondary btn-sm w-100">
            Login to Apply
          </a>
        {% endif %}

      </div>

    </div>
  </div>
</div>

</div>


      </div>
    </div>
  </div>

{% empty %}
  <div class="col-12">
    <div class="alert alert-warning">
      No jobs available
    </div>
  </div>
{% endfor %}

</div>

<!-- RECOMMENDED JOBS -->
{% if recommended_jobs %}
<hr class="my-5">

<h3 class="mb-4 text-success">Recommended Jobs</h3>

<div class="row g-4">

{% for job in recommended_jobs %}
  <div class="col-md-6 col-lg-4">
    <div class="card border-success h-100">
      <div class="card-body d-flex flex-column">

        <h5>{{ job.title }}</h5>
        <p class="text-muted small">
          {{ job.company }} â€¢ {{ job.location }}
        </p>

        <span class="badge bg-success mt-auto">
          Skill Match
        </span>

      </div>
    </div>
  </div>
{% endfor %}

</div>
{% endif %}

{% endblock %}

