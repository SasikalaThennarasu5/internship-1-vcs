{% extends "base.html" %}
{% block title %}Consultant Dashboard{% endblock %}

{% block content %}

<style>
    .dashboard-card {
        border-radius: 12px;
        transition: all 0.2s ease;
    }

    .dashboard-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 25px rgba(0,0,0,0.08);
    }

    .status-badge {
        padding: 6px 12px;
        border-radius: 50px;
        font-size: 12px;
        font-weight: 600;
    }

    .scheduled { background: #e7f1ff; color: #0d6efd; }
    .completed { background: #e6f9f0; color: #198754; }
    .cancelled { background: #fde8e8; color: #dc3545; }
</style>

<div class="container py-5">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="fw-bold mb-1">Consultant Dashboard</h4>
            <p class="text-muted small mb-0">
                Manage your scheduled mock interviews
            </p>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h5 class="fw-bold">{{ total }}</h5>
                <small class="text-muted">Total Interviews</small>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h5 class="fw-bold text-primary">{{ scheduled }}</h5>
                <small class="text-muted">Scheduled</small>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h5 class="fw-bold text-success">{{ completed }}</h5>
                <small class="text-muted">Completed</small>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h5 class="fw-bold text-danger">{{ cancelled }}</h5>
                <small class="text-muted">Cancelled</small>
            </div>
        </div>
    </div>

    <!-- Chart -->
    <div class="card shadow-sm border-0 p-4 mb-4">
        <h6 class="fw-semibold mb-3">üìä Interview Completion Overview</h6>
        <canvas id="progressChart" height="100"></canvas>
    </div>

    <!-- Today's Interviews -->
    {% if upcoming_today %}
    <div class="alert alert-info shadow-sm">
        <strong>üìÖ Today's Interviews:</strong>
        <ul class="mb-0">
            {% for interview in upcoming_today %}
            <li>
                {{ interview.user.username }} ‚Äî
                {{ interview.get_interview_type_display }}
                at {{ interview.scheduled_at|time:"H:i" }}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- SLA Breach -->
    {% if breached %}
    <div class="alert alert-danger shadow-sm">
        <strong>üö® SLA Breach Warning!</strong>
        <ul class="mb-0">
            {% for interview in breached %}
            <li>
                {{ interview.user.username }} ‚Äî
                {{ interview.get_interview_type_display }} overdue
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Interviews List -->
    {% if interviews %}
    <div class="row g-4">
        {% for interview in interviews %}
        <div class="col-md-6">
            <div class="card dashboard-card shadow-sm p-4 border-0">

                <!-- Candidate + Status -->
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="fw-semibold mb-1">
                            {{ interview.user.username }}
                        </h6>
                        <small class="text-muted">
                            {{ interview.get_interview_type_display }}
                        </small>
                    </div>

                    {% if interview.status == "SCHEDULED" %}
                        <span class="status-badge scheduled">Scheduled</span>
                    {% elif interview.status == "COMPLETED" %}
                        <span class="status-badge completed">Completed</span>
                    {% else %}
                        <span class="status-badge cancelled">Cancelled</span>
                    {% endif %}
                </div>

                <hr>

                <!-- Date -->
                <p class="mb-2 small text-muted">
                    üìÖ {{ interview.scheduled_at|date:"M d, Y ‚Äì h:i A" }}
                </p>

                <!-- Meeting Link -->
                {% if interview.meeting_link %}
                <p class="small">
                    üîó <a href="{{ interview.meeting_link }}" target="_blank">
                        Join Meeting
                    </a>
                </p>
                {% endif %}

                <!-- Actions -->
                {% if interview.status == "SCHEDULED" %}
                <div class="d-flex gap-2 mt-3">

                    <form method="post"
                          action="{% url 'mock_interviews:mark_completed' interview.id %}"
                          class="w-50">
                        {% csrf_token %}
                        <button type="submit"
                                class="btn btn-sm btn-success w-100">
                            ‚úî Mark Completed
                        </button>
                    </form>

                    <a href="{% url 'mock_interviews:upload_feedback' interview.id %}"
                       class="btn btn-sm btn-outline-primary w-50">
                        üìù Upload Feedback
                    </a>

                </div>
                {% endif %}

            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
        <div class="text-center py-5">
            <h6 class="text-muted">No interviews assigned yet.</h6>
        </div>
    {% endif %}

</div>

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('progressChart');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Scheduled', 'Completed', 'Cancelled'],
            datasets: [{
                data: [
                    {{ scheduled }},
                    {{ completed }},
                    {{ cancelled }}
                ],
                backgroundColor: [
                    '#0d6efd',
                    '#198754',
                    '#dc3545'
                ],
                borderRadius: 6
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>

{% endblock %}
