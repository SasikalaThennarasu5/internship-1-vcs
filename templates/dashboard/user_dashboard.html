{% extends "base.html" %}

{% block title %}My Dashboard{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- PAGE HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">ðŸ‘¤ My Dashboard</h2>
    <a href="{% url 'profiles:setup' %}" class="btn btn-outline-primary btn-sm">
      Edit Profile
    </a>
  </div>

  <!-- SUMMARY CARDS -->
  <div class="row g-4 mb-4">

    <div class="col-sm-6 col-lg-3">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <h6 class="text-muted mb-1">Profile Completion</h6>
          <h3 class="fw-bold text-success">{{ completion }}%</h3>
        </div>
      </div>
    </div>

    <div class="col-sm-6 col-lg-3">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <h6 class="text-muted mb-1">Applied Jobs</h6>
          <h3 class="fw-bold">{{ applications|length }}</h3>
        </div>
      </div>
    </div>

  </div>

  <!-- PROFILE COMPLETION -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <h5 class="mb-3">Profile Status</h5>

      <div class="progress mb-2" style="height: 10px;">
        <div class="progress-bar bg-success"
             role="progressbar"
             style="width: {{ completion }}%;"
             aria-valuenow="{{ completion }}"
             aria-valuemin="0"
             aria-valuemax="100">
        </div>
      </div>

      {% if completion < 100 %}
        <small class="text-danger">
          âš  Complete your profile to unlock more job applications
        </small>
      {% else %}
        <small class="text-success">
          âœ… Your profile is complete
        </small>
      {% endif %}
    </div>
  </div>

  <!-- APPLIED JOBS -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">

      <h4 class="mb-3">Applied Jobs</h4>

      {% if applications %}

        <!-- QUICK LIST -->
        <ul class="list-group mb-4">
          {% for app in applications %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>
                <strong>{{ app.job.title }}</strong>
                <span class="text-muted">â€“ {{ app.job.company }}</span>
              </span>

              {% if app.status == "applied" %}
                <span class="badge bg-warning">Applied</span>
              {% elif app.status == "shortlisted" %}
                <span class="badge bg-success">Shortlisted</span>
              {% else %}
                <span class="badge bg-danger">Rejected</span>
              {% endif %}
            </li>
          {% endfor %}
        </ul>

        <!-- APPLICATION TABLE -->
        <h5 class="mb-3">My Applications</h5>

        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Job</th>
                <th>Status</th>
                <th>Applied On</th>
              </tr>
            </thead>
            <tbody>
              {% for app in applications %}
                <tr>
                  <td>{{ app.job.title }}</td>
                  <td>
                    <span class="badge
                      {% if app.status == 'applied' %}bg-warning
                      {% elif app.status == 'shortlisted' %}bg-success
                      {% else %}bg-danger{% endif %}">
                      {{ app.status|title }}
                    </span>
                  </td>
                  <td>{{ app.applied_at|date:"d M Y" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      {% else %}
        <div class="alert alert-info mb-0">
          You have not applied to any jobs yet.
        </div>
      {% endif %}

    </div>
  </div>

</div>
{% endblock %}
