{% extends "base.html" %}

{% block title %}My Dashboard{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- PAGE HEADER -->
  <div class="dashboard-header d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="fw-bold mb-1">Welcome back, {{ request.user.first_name|default:request.user.username }}</h3>
    <small>Here‚Äôs your career progress overview</small>
  </div>
  <a href="{% url 'profiles:setup' %}" class="btn btn-light btn-sm shadow-sm">
    Edit Profile
  </a>
</div>

  <div class="card shadow-sm mb-4">
  <div class="card-body">

    <h5 class="card-title mb-3">Your Subscription</h5>

    <p>
      <strong>Plan:</strong>
      {% if subscription.plan == "FREE" %}
        <span class="badge bg-secondary">FREE</span>
      {% elif subscription.plan == "PRO" %}
        <span class="badge bg-success">PRO ‚úì</span>
      {% elif subscription.plan == "PRO_PLUS" %}
        <span class="badge bg-warning text-dark">
          PRO PLUS ‚≠ê
        </span>
      {% endif %}
    </p>

    <p>
      <strong>Status:</strong>
      {% if subscription.is_active %}
        <span class="text-success">Active</span>
      {% else %}
        <span class="text-danger">Inactive</span>
      {% endif %}
    </p>

    <p>
      <strong>Valid Till:</strong>
      {% if subscription.end_date %}
        {{ subscription.end_date|date:"d M Y" }}
      {% else %}
        Unlimited
      {% endif %}
    </p>

    {% if subscription.plan == "FREE" %}
      <a href="{% url 'subscriptions:plan_select' %}"
         class="btn btn-primary btn-sm">
        Upgrade Plan
      </a>
    {% endif %}

    <p>
  <strong>Applications Used:</strong>
  {{ applications|length }}
  {% if subscription.plan == "FREE" %}
    / 5
  {% elif subscription.plan == "PRO" %}
    / 20
  {% else %}
    / Unlimited
  {% endif %}
</p>

  </div>
</div>

  <!-- SUMMARY CARDS -->
  <div class="row g-4 mb-4">

  <div class="col-md-3">
    <div class="stat-card text-center">
      <div class="stat-icon text-success">üìä</div>
      <h6 class="text-muted mt-2">Profile Completion</h6>
      <h3 class="fw-bold text-success">{{ completion }}%</h3>
    </div>
  </div>

  <div class="col-md-3">
    <div class="stat-card text-center">
      <div class="stat-icon text-primary">üíº</div>
      <h6 class="text-muted mt-2">Applied Jobs</h6>
      <h3 class="fw-bold">{{ applications|length }}</h3>
    </div>
  </div>

  <div class="col-md-3">
    <div class="stat-card text-center">
      <div class="stat-icon text-warning">üé§</div>
      <h6 class="text-muted mt-2">Mock Interviews</h6>
      <h3 class="fw-bold">{{ mock_interviews.count }}</h3>
    </div>
  </div>

  <div class="col-md-3">
    <div class="stat-card text-center">
      <div class="stat-icon text-info">üßë‚Äçüíº</div>
      <h6 class="text-muted mt-2">Consultant Sessions</h6>
      <h3 class="fw-bold">{{ consultant_sessions.count }}</h3>
    </div>
  </div>

</div>


  <!-- PROFILE COMPLETION -->
  <div class="section-card">
  <h5 class="fw-semibold mb-3">Profile Completion</h5>

  <div class="progress mb-3">
    <div class="progress-bar bg-success"
         style="width: {{ completion }}%;">
    </div>
  </div>

  {% if completion < 100 %}
    <div class="alert alert-warning py-2 mb-0">
      Complete your profile to unlock more job applications
    </div>
  {% else %}
    <div class="alert alert-success py-2 mb-0">
      Your profile is fully completed
    </div>
  {% endif %}
</div>


  <!-- APPLIED JOBS -->
  <div class="section-card"> 
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">

      <h4 class="mb-3">Applied Jobs</h4>

      {% if applications %}

        <!-- QUICK LIST -->
        <ul class="list-group mb-4">
          {% for app in applications %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>
                <strong>{{ app.job.title }}</strong>
                <span class="text-muted">‚Äì {{ app.job.company }}</span>
              </span>

              {% if app.status == "applied" %}
                <span class="badge bg-warning">Applied</span>
              {% elif app.status == "shortlisted" %}
                <span class="badge bg-success">Shortlisted</span>
              {% else %}
                <span class="badge bg-danger">Rejected</span>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
        </div>

        <!-- APPLICATION TABLE -->
        <h5 class="mb-3">My Applications</h5>

        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Job</th>
                <th>Status</th>
                <th>Applied On</th>
              </tr>
            </thead>
            <tbody>
              {% for app in applications %}
                <tr>
                  <td>{{ app.job.title }}</td>
                  <td>
                    <span class="badge badge-modern 
{% if app.status == 'applied' %}bg-warning
{% elif app.status == 'shortlisted' %}bg-success
{% else %}bg-danger{% endif %}">
                      {{ app.status|title }}
                    </span>
                  </td>
                  <td>{{ app.applied_at|date:"d M Y" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      {% else %}
        <div class="alert alert-info mb-0">
          You have not applied to any jobs yet.
        </div>
      {% endif %}

    </div>
  </div>

</div>

<hr>

<h4 class="mt-4">üéì My Certificates</h4>

{% if certificates %}
  <div class="row">
    {% for enroll in certificates %}
      <div class="col-md-4">
        <div class="card shadow-sm mb-3">
          <div class="card-body">
            <h6 class="card-title">
              {{ enroll.course.title }}
            </h6>

            <p class="text-success small mb-2">
              ‚úî Completed
            </p>

            <a href="{% url 'training:certificate' enroll.id %}"
               class="btn btn-sm btn-outline-primary">
              ‚¨á Download Certificate
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted">
    No certificates earned yet.
  </p>
{% endif %}

<div class="row g-3 mb-4">

  <!-- Subscription -->
<div class="section-card">
  <div class="col-md-3">
    <div class="card shadow-sm border-0 text-center p-3">
      <h6 class="text-muted">Current Plan</h6>
      <h4 class="fw-bold text-primary">{{ subscription.plan }}</h4>
    </div>
  </div>

  <!-- Consultant Sessions -->
  <div class="col-md-3">
    <div class="card shadow-sm border-0 text-center p-3">
      <h6 class="text-muted">Consultant Sessions</h6>
      <h4 class="fw-semibold">
        {{ consultant_sessions.count }}
      </h4>
    </div>
  </div>

  <!-- Mock Interviews -->
  <div class="col-md-3">
    <div class="card shadow-sm border-0 text-center p-3">
      <h6 class="text-muted">Mock Interviews</h6>
      <h4 class="fw-semibold">
        {{ mock_interviews.count }}
      </h4>
    </div>
  </div>

  <a href="{% url 'consultants:calendar' %}" class="btn btn-outline-primary btn-sm">
  My Calendar
</a>
</div>

  <!-- Resume Reviews -->
  <div class="col-md-3">
    <div class="card shadow-sm border-0 text-center p-3">
      <h6 class="text-muted">Resume Reviews</h6>
      <h4 class="fw-semibold">
        {{ resume_reviews.count }}
      </h4>
    </div>
  </div>

</div>

<div class="card shadow-sm border-0 mb-4">
  <div class="card-header bg-white fw-semibold">
    Consultant Sessions
  </div>
  <div class="card-body">

    {% if consultant_sessions %}
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Consultant</th>
            <th>Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for s in consultant_sessions %}
            <tr>
              <td>{{ s.consultant }}</td>
              <td>{{ s.scheduled_at|date:"d M Y H:i" }}</td>
              <td>
                <span class="badge 
{% if s.status == 'COMPLETED' %}bg-success
{% elif s.status == 'SCHEDULED' %}bg-warning
{% else %}bg-danger{% endif %}">
  {{ s.status }}
</span>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No sessions yet.</p>
    {% endif %}

  </div>
</div>

<hr class="my-4">

<h5 class="fw-semibold mb-3">üéØ Career Services</h5>

<div class="row g-3">

  <!-- Mock Interviews -->
  <div class="col-md-6 col-lg-4">
    <div class="card service-card h-100 border-0 shadow-sm p-2">
      <div class="card-body">
        <h6 class="fw-semibold">üé§ Mock Interviews</h6>
        <p class="text-muted small">
          Practice interviews with expert consultants
        </p>
        <a href="{% url 'mock_interviews:my_interviews' %}"
           class="btn btn-primary btn-sm">
          View
        </a>
      </div>
    </div>
  </div>

  <!-- Consultant Sessions -->
  <div class="col-md-6 col-lg-4">
    <div class="card service-card h-100 border-0 shadow-sm p-2">
      <div class="card-body">
        <h6 class="fw-semibold">üßë‚Äçüíº Consultant Sessions</h6>
        <p class="text-muted small">
          1-on-1 career guidance sessions
        </p>
        <a href="/consultants/schedule/"
           class="btn btn-primary btn-sm">
          View
        </a>
      </div>
    </div>
  </div>

  <!-- Resume Optimization -->
  <div class="col-md-6 col-lg-4">
    <div class="card service-card h-100 border-0 shadow-sm p-2">
      <div class="card-body">
        <h6 class="fw-semibold">üìÑ Resume Optimization</h6>
        <p class="text-muted small">
          Get your resume reviewed by experts
        </p>
        
        <a href="/resume/upload/"
           class="btn btn-primary btn-sm">
          View
        </a>
      </div>
    </div>
  </div>

</div>


{% endblock %}
